@page "/"
@using Blazored.TextEditor
@using Stratom.Form.Core.Models
@using Stratom.Form.Core.Services
@using System.Security.Claims
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@inject IFicheService ficheService

@if (fiche == null)
{
    <p><em>Loading...</em></p>
}
else
{
    @*<table class="table">
            <thead>
                <tr>
                    <th>NumeroFiche</th>
                    <th>student_id</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in ficheList)
                {
                    <tr>
                        <td>@item.NumeroFiche</td>
                        <td>@item.student_id</td>
                    </tr>
                }
            </tbody>
        </table>*@
    <h3>@NumeroFiche</h3>
    <br>
    <br>
    <label>Activities Table</label>
    <input type="text" value="@activite.Souscription" class="form-control" placeholder="Souscription">
    <input type="text" value="@activite.Autre" class="form-control" placeholder="Autre">
    <br />
    <label>Activite Type Table</label>
    <input type="text" value="@activiteType.Libelle" class="form-control" placeholder="Libelle">
    <br />
    <label>Assurance Dommage Table</label>
    <input type="text" value="@assuranceDommage.Autre" class="form-control" placeholder="Autre">
    <input type="text" value="@assuranceDommage.Libelle" class="form-control" placeholder="Libelle">
    <br />
    <label>Assurance Personne Table</label>
    <input type="text" value="@assurancePersonne.Libelle" class="form-control" placeholder="Libelle">
    <input type="text" value="@assurancePersonne.Autre" class="form-control" placeholder="Autre">
    <br />
    <label>Concerne Personne Table</label>
    <input type="text" value="@concerne.Libelle" class="form-control" placeholder="Libelle">
    <br />
    <label>Contrats Portefeuille Table</label>
    <input type="text" value="@contratsPortefeuille.Type" class="form-control" placeholder="Type">
    <input type="text" value="@contratsPortefeuille.Garantie" class="form-control" placeholder="Garantie">
    <input type="Date" value="@contratsPortefeuille.DateSouscription" class="form-control" placeholder="Date">
    <input type="text" value="@contratsPortefeuille.CotisationAnnuelle" class="form-control" placeholder="Cotisation Annuelle">
    <input type="text" value="@contratsPortefeuille.Autre" class="form-control" placeholder="Autre">
    <br />
    <label>Description Activite Table</label>
    <input type="text" value="@descriptionActivite.ContactOrigine" class="form-control" placeholder="Contact Origine">
    <input type="text" value="@descriptionActivite.ContactFaceAFace" class="form-control" placeholder="Contact FaceAFace">
    <input type="text" value="@descriptionActivite.ContactTelephone" class="form-control" placeholder="Contact Telephone">
    <input type="text" value="@descriptionActivite.ContactRole" class="form-control" placeholder="Contact Role">
    <input type="text" value="@descriptionActivite.EntretienObjectifs" class="form-control" placeholder="Entretien Objectifs">
    <input type="text" value="@descriptionActivite.EntretienDeroulement" class="form-control" placeholder="Entretien Deroulement">
    <br />
    <label>Fiche Client Prospect Table</label>
    <input type="text" value="@ficheClientProspect.Nom" class="form-control" placeholder="Nom">
    <input type="text" value="@ficheClientProspect.Prenom" class="form-control" placeholder="Prenom">
    <input type="text" value="@ficheClientProspect.Sexe" class="form-control" placeholder="Sexe">
    <input type="number" value="@ficheClientProspect.Age" class="form-control" placeholder="Age">
    <input type="text" value="@ficheClientProspect.Adresse" class="form-control" placeholder="Adresse">
    <input type="number" value="@ficheClientProspect.CodePostal" class="form-control" placeholder="CodePostal">
    <input type="text" value="@ficheClientProspect.Ville" class="form-control" placeholder="Ville">
    <input type="number" value="@ficheClientProspect.Telephone" class="form-control" placeholder="Telephone">
    <input type="number" value="@ficheClientProspect.Mobile" class="form-control" placeholder="Mobile">
    <input type="text" value="@ficheClientProspect.Mail" class="form-control" placeholder="Mail">
    <input type="text" value="@ficheClientProspect.Autre" class="form-control" placeholder="Autre">
    <input type="text" value="@ficheClientProspect.SituationFamiliale" class="form-control" placeholder="SituationFamiliale">
    <input type="text" value="@ficheClientProspect.NbEnfants" class="form-control" placeholder="NbEnfants">
    <input type="number" value="@ficheClientProspect.AgesEnfants" class="form-control" placeholder="AgesEnfants">
    <input type="text" value="@ficheClientProspect.SituationProfessionnelle" class="form-control" placeholder="SituationProfessionnelle">
    <input type="checkbox" value="@ficheClientProspect.IsClient" class="form-control" placeholder="IsClient">
    <input type="text" value="@ficheClientProspect.Statut" class="form-control" placeholder="Statut">
    <input type="number" value="@ficheClientProspect.AgesEnfants" class="form-control" placeholder="AgesEnfants">
    <input type="text" value="@ficheClientProspect.Anciennete" class="form-control" placeholder="Anciennete">
    <input type="text" value="@ficheClientProspect.Revenus" class="form-control" placeholder="Revenus">
    <input type="text" value="@ficheClientProspect.TauxImposition" class="form-control" placeholder="TauxImposition">
    <input type="text" value="@ficheClientProspect.Placements" class="form-control" placeholder="Placements">
    <br />
    <label>Fiche Fin Table</label>
    <input type="text" value="@ficheFin.InformationsAConserver" class="form-control" placeholder="InformationsAConserver">
    <input type="text" value="@ficheFin.PlanificationActions" class="form-control" placeholder="PlanificationActions">
    <input type="text" value="@ficheFin.AutoEvaluation" class="form-control" placeholder="AutoEvaluation">
    <label>Phases Table</label>
    <input type="text" value="@phase.PhaseContact" class="form-control" placeholder="PhaseContact">
    <input type="text" value="@phase.PhaseDecouverte" class="form-control" placeholder="PhaseDecouverte">
    <input type="text" value="@phase.PhaseTransition" class="form-control" placeholder="PhaseTransition">
    <input type="text" value="@phase.PhaseVente" class="form-control" placeholder="PhaseVente">
    <input type="text" value="@phase.PhaseConclusion" class="form-control" placeholder="PhaseConclusion">
    <input type="text" value="@phase.PhaseAsseoirVente" class="form-control" placeholder="PhaseAsseoirVente">
    <input type="text" value="@phase.PhasePriseConge" class="form-control" placeholder="PhasePriseConge">


}


@code {

    public IEnumerable<Fiche> ficheList { get; set; }
    public Activite activite { get; set; }
    public ActiviteType activiteType { get; set; }
    public AssuranceDommage assuranceDommage { get; set; }
    public AssurancePersonne assurancePersonne { get; set; }
    public Concerne concerne { get; set; }
    public ContratsPortefeuille contratsPortefeuille { get; set; }
    public DescriptionActivite descriptionActivite { get; set; }
    public FicheClientProspect ficheClientProspect { get; set; }
    public FicheContexteSimplifiee ficheContexteSimplifiee { get; set; }
    public FicheFin ficheFin { get; set; }
    public Phase phase { get; set; }
    public Fiche fiche { get; set; }
    public string NumeroFiche { get; set; }
    protected override async Task OnInitializedAsync()
    {
        var principal = HttpContextAccessor.HttpContext.User;
        var loggedInUserId = principal.FindFirstValue(ClaimTypes.NameIdentifier);
        //fiche = new IEnumerable<Fiche>();
        ficheList = (await ficheService.GetAllFiches()).ToList();
        fiche = ficheList.FirstOrDefault(x => x.student_id == loggedInUserId);
        NumeroFiche = "Document No. " + fiche.NumeroFiche;
        //Set Models
        activite = fiche.Activites.FirstOrDefault();
        activiteType = fiche.ActiviteTypes.FirstOrDefault();
        assuranceDommage = fiche.AssurancesDommage.FirstOrDefault();
        assurancePersonne = fiche.AssurancesPersonne.FirstOrDefault();
        concerne = fiche.Concernes.FirstOrDefault();
        contratsPortefeuille = fiche.ContratsPortefeuilles.FirstOrDefault();
        descriptionActivite = fiche.DescriptionsActivite.FirstOrDefault();
        ficheClientProspect = fiche.FichesClientProspect.FirstOrDefault();
        ficheContexteSimplifiee = fiche.FichesContexteSimplifiee.FirstOrDefault();
        ficheFin = fiche.FichesFin.FirstOrDefault();
        phase = fiche.Phases.FirstOrDefault();
        await base.OnInitializedAsync();
    }

}